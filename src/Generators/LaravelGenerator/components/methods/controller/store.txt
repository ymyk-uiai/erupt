<!erupt
    model = self.files.model.className
    modelInstance = self.files.model.instance
    modelFullClass = self.files.model.fullClassName
    resourceUseAs = self.files.resource.useAs
    storeRequestClass = self.files.request@store.className
    authInstance = auth.files.model.instance
!>

<!erupt
    print("public function store({} $request)", storeRequestClass)
!>
{
    <!erupt
        print("$this->authorize('create', '{}')", modelFullClass)
    !>

    $validated = $request->validated();

    <!erupt
        foreach self.attributes.fillable as fillable join "," into result {
            preprint("${} = new {}([", modelInstance, model)
            print("'{}' => $validated['{}']", fillable.name, fillable.name)
            postprint("]);")
        }
        print("{}", result)
    !>

    <!erupt
        print("$request->{}()->{}()->save({})", authInstance, collectionInstance, modelInstace)
    !>
    
    <!erupt
        print("return new {}(${})", resourceUseAs, modelInstance)
    !>
}

<data>
{
    "name": "controller_store",
    "type": "php_class",
    "components": [],
    "use": []
}
</data>